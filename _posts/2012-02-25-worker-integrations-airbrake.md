---
permalink: /worker/articles/integrations/airbrake
title: Integrating with Airbrake
categories:
 - worker
 - articles
 - integrations
breadcrumbs:
  - ['Articles', '/articles']
  - ['Integrations', '/integrations']
  - ['Airbrake', '/airbrake']
tags:
 - airbrake
 - integrations
 - exceptions
languages:
- name: 'ruby'
  command: 'ruby'
  extension: 'rb'
- name: 'php'
  command: 'php'
  extension: 'php'
summary: "[Airbrake](http://www.airbrake.io) collects errors generated by other applications and aggregates the results for review. You will always see worker errors in the IronWorker UI as well as the log output, but by following this tutorial you can also send worker errors over to Airbrake."
layout: default
section: worker
---

# Integrating with Airbrake

{% if page.languages %}
{% include language-switcher-head.html %}
{% endif %}

[Airbrake](http://www.airbrake.io) collects errors generated by other applications and aggregates the results for review. You
will always see worker errors in the IronWorker UI as well as the log output, but by following this tutorial you can also
send worker errors over to Airbrake.

{% include language-switcher.html %}

## Step 1: Airbrake Library

Merge the Airbrake library into your worker.

<div class="ruby">
{% highlight ruby %}
merge_gem 'airbrake'
{% endhighlight %}
</div>
<div class="php">
{% highlight php %}
<?php
require_once dirname(__FILE__) . '/lib/Airbrake.class.php';
{% endhighlight %}
</div>


## Step 2: Configure Airbrake

Add the Airbrake configuration block to your worker

<div class="ruby">
{% highlight ruby %}
Airbrake.configure do |config|
  config.api_key = api_key
end
{% endhighlight %}
</div>
<div class="php">
{% highlight php %}
<?php
$brake = new Services_Airbrake('API_Key', 'production', 'curl');
{% endhighlight %}
</div>


## Step 3: Catch Errors

You need to wrap your worker with a begin-rescue or try-catch block in order to catch and send to Airbrake.

<div class="ruby">
{% highlight ruby %}
def run
  begin
    # Your worker code in here

  rescue => ex

  end
end
{% endhighlight %}
</div>
<div class="php">
{% highlight php %}
<?php
try {
    //do something
}
catch (Exception $e) {
    //.....
}
{% endhighlight %}
</div>


## Step 4: Send caught errors to Airbrake

After we catch the error, let's send it to Airbrake and re-raise it so the worker fails (otherwise the worker would complete successfully, but wouldn't work as expected).

<div class="ruby">
{% highlight ruby %}
Airbrake.notify(
  :error_class => "#{self.class}",
  :error_message => "#{ex} - #{ex.backtrace}"
)
puts "Error sent to Airbrake."
raise ex
{% endhighlight %}
</div>
<div class="php">
{% highlight php %}
<?php
    $brake->notify(get_class($e), $e->getMessage(), $e->getFile(), $e->getLine(),
        $e->getTrace(), "worker");
{% endhighlight %}
</div>




## That's it! Full worker below.

<div class="ruby">
{% highlight ruby %}
require 'iron_worker'

class WorkerWithAirbrake < IronWorker::Base
  attr_accessor :api_key

  merge_gem 'airbrake'

  def run
    begin
      Airbrake.configure do |config|
        config.api_key = api_key
      end
      #--- YOUR WORKER CODE BELOW HERE ---


    rescue => ex
      Airbrake.notify(
        :error_class => "#{self.class}",
        :error_message => "#{ex} - #{ex.backtrace}"
      )
      puts "Error sent to Airbrake."
      raise ex
    end
  end
end
{% endhighlight %}
</div>

<div class="php">
{% highlight php %}
<?php
require_once dirname(__FILE__) . '/lib/Airbrake.class.php';
$brake = new Services_Airbrake('API_Key', 'production', 'curl');

// YOUR WORKER CODE HERE

try {
    //do something
}
catch (Exception $e) {
    $brake->notify(get_class($e), $e->getMessage(), $e->getFile(), $e->getLine(),
        $e->getTrace(), "worker");
}
{% endhighlight %}
</div>

## And a sample runner file you can run to call the worker

<div class="ruby">
{% highlight ruby %}
require 'iron_worker'

load "worker_with_airbrake.rb"

IronWorker.configure do |config|
  config.token = TOKEN
  config.project_id = PROJECT_ID
end

worker = WorkerWithAirbrake.new
worker.api_key = AIRBRAKE_API_KEY

worker.queue
{% endhighlight %}
</div>
<div class="php">
{% highlight php %}
<?php
include("../IronWorker.class.php");

$name = "airbrake-php";

$iw = new IronWorker('config.ini');
$iw->debug_enabled = true;

$zipName = "code/$name.zip";

$zipFile =
    IronWorker::zipDirectory(dirname(__FILE__)."/workers/airbrake", $zipName, true);

$res = $iw->postCode('airbrake.php', $zipName, $name);

$payload = array('api_key' => AIRBRAKE_API_KEY);

$iw->postTask($name, $payload);
{% endhighlight %}
</div>
